name: CodeQL TS/TSX

on:
    push:
        branches: ["main", "dev"]
        paths:
            - "**/*.ts"
            - "**/*.tsx"
            - "package.json"
            - "package-lock.json"
            - "tsconfig*.json"
            - ".github/workflows/**"
    pull_request:
        branches: ["main", "dev"]
        paths:
            - "**/*.ts"
            - "**/*.tsx"
            - "package.json"
            - "package-lock.json"
            - "tsconfig*.json"
            - ".github/workflows/**"

concurrency:
    group: codeql-${{ github.workflow }}-${{ github.ref }}
    cancel-in-progress: true

jobs:
    analyze:
        name: CodeQL (javascript-typescript)
        runs-on: ubuntu-latest
        permissions:
            security-events: write
            contents: read
            actions: read
            packages: read
        steps:
            - name: Checkout
              uses: actions/checkout@v4
            - name: Setup Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: "20"
                  cache: "npm"
            - name: Install deps
              run: npm ci
              env:
                  NODE_ENV: development
            - name: Initialize CodeQL
              uses: github/codeql-action/init@v3
              with:
                  languages: javascript-typescript
                  build-mode: none
                  queries: +security-extended,security-and-quality
            - name: Perform CodeQL Analysis
              uses: github/codeql-action/analyze@v3
              with:
                  category: "/language:javascript-typescript"
